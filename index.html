<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>avatar maker</title>
  <style>
    html,
    body,
    .frame {
      width: 1080px;
      height: 800px;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Fira Sans,
        Droid Sans, Helvetica Neue, sans-serif;
      padding: 20px;
      font-size: 14px;
      border: none;
    }

    h2 {
      text-transform: lowercase;
    }

    .warning {
      background-color: #df68a2;
      padding: 3px;
      border-radius: 5px;
      color: white;
      font-size: 13px;
    }

    button {
      background-color: #000;
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #333;
    }

    #avatarUrl {
      margin-top: 15px;
      font-size: 13px;
    }

    .copy-btn {
      background-color: #df68a2;
      margin-left: 10px;
      font-size: 12px;
      padding: 6px 10px;
    }
  </style>
</head>

<body>
  <h2>ready player me - model maker</h2>

  <button onclick="displayIframe()">open</button>

  <p class="warning">replace 'demo' with your subdomain if needed</p>

  <p id="avatarUrl">avatar url: <span id="urlText">none yet</span>
    <button class="copy-btn" onclick="copyUrl()">copy</button>
  </p>

  <iframe id="frame" class="frame" allow="camera *; microphone *; clipboard-write" hidden></iframe>

  <script>
    const subdomain = 'demo';
    const frame = document.getElementById('frame');
    const urlText = document.getElementById('urlText');

    frame.src = `https://${subdomain}.readyplayer.me/avatar?frameApi`;

    window.addEventListener('message', subscribe);
    document.addEventListener('message', subscribe);

    function subscribe(event) {
      const json = parse(event);

      if (json?.source !== 'readyplayerme') return;

      if (json.eventName === 'v1.frame.ready') {
        frame.contentWindow.postMessage(
          JSON.stringify({
            target: 'readyplayerme',
            type: 'subscribe',
            eventName: 'v1.**'
          }),
          '*'
        );
      }

      if (json.eventName === 'v1.avatar.exported') {
        const url = json.data.url;
        console.log(`Avatar URL: ${url}`);
        urlText.textContent = url;
        frame.hidden = true;
      }

      if (json.eventName === 'v1.user.set') {
        console.log(`User with id ${json.data.id} set: ${JSON.stringify(json)}`);
      }
    }

    function parse(event) {
      try {
        return JSON.parse(event.data);
      } catch {
        return null;
      }
    }

    function displayIframe() {
      frame.hidden = false;
    }

    function copyUrl() {
      const text = urlText.textContent;
      if (text && text !== 'none yet') {
        navigator.clipboard.writeText(text);
        alert('Avatar URL copied!');
      }
    }
  </script>
</body>

</html>
